# 25EDC - STM32F407 电子设计竞赛项目

## 项目简介

25EDC是一个基于STM32F407微控制器的综合性电子设计项目，专为2025年电子设计竞赛而开发。该项目集成了信号处理、波形分析、人机交互等多种功能，展示了STM32F407强大的处理能力和丰富的外设接口。

## 主要特性

### 🎯 核心功能
- **信号分析与处理**: 集成FFT快速傅里叶变换，实时频谱分析
- **波形识别**: 智能波形检测算法，支持多种波形类型识别
- **信号生成**: AD9833 DDS信号发生器，可产生正弦波、三角波等
- **频率测量**: 高精度方波频率测量功能
- **数据存储**: W25QXX SPI Flash存储器，支持数据读写

### 🔧 硬件接口
- **ADC采集**: 双通道ADC采样，支持DMA传输
- **DAC输出**: 12位DAC输出，可调节电压
- **LCD显示**: 彩色LCD显示屏，支持图形和文字显示
- **触摸屏**: XPT2046电阻触摸屏，支持触摸交互
- **通信接口**: UART、SPI、I2C、CAN等多种通信协议
- **按键控制**: 硬件按键输入，支持多种操作模式
- **LED指示**: 状态指示LED

### 📊 信号处理
- **FFT分析**: 实时频谱分析，支持可配置的采样频率和点数
- **卷积运算**: 数字信号卷积处理
- **PID控制**: 比例-积分-微分控制器
- **PWM输出**: 可调节频率和占空比的PWM信号

## 系统配置

### 时钟配置
- **HSE**: 8MHz (外部高速时钟)
- **SYSCLK**: 168MHz (系统时钟)
- **HCLK**: 168MHz (AHB总线时钟)
- **PCLK1**: 42MHz (APB1总线时钟)
- **PCLK2**: 84MHz (APB2总线时钟)

### 开发环境
- **IDE**: Keil MDK-ARM
- **编译器**: ARM Compiler
- **调试器**: ST-Link
- **目标芯片**: STM32F407VGT6

## 项目结构

```
25EDC/
├── Main/                    # 主程序文件
│   ├── main.c              # 主程序入口
│   ├── stm32f4xx_it.c      # 中断服务程序
│   └── stm32f4xx_it.h      # 中断头文件
├── USER/                    # 用户应用代码
│   ├── src/                # 源文件
│   │   ├── adc.c           # ADC驱动
│   │   ├── dac.c           # DAC驱动
│   │   ├── lcd.c           # LCD驱动
│   │   ├── fft.c           # FFT处理
│   │   ├── spi.c           # SPI通信
│   │   ├── uart.c          # 串口通信
│   │   ├── i2c.c           # I2C通信
│   │   ├── key.c           # 按键处理
│   │   ├── led.c           # LED控制
│   │   ├── timer.c         # 定时器
│   │   ├── pwm.c           # PWM输出
│   │   ├── dma.c           # DMA传输
│   │   ├── w25qxx.c        # Flash存储
│   │   ├── AD9833.c        # DDS信号发生器
│   │   ├── xpt2046.c       # 触摸屏控制器
│   │   ├── touch.c         # 触摸处理
│   │   ├── pid.c           # PID控制器
│   │   ├── freqmeas.c      # 频率测量
│   │   ├── convolution.c   # 卷积运算
│   │   ├── wavetest.c      # 波形分析
│   │   └── arm_cmsis_dsp.c # ARM DSP库
│   └── inc/                # 头文件
│       ├── *.h             # 对应源文件的头文件
│       ├── font.h          # 字体文件
│       └── arm_cmsis_dsp.h # ARM DSP库头文件
├── STM32F4_FWLIB/          # STM32F4固件库
│   ├── inc/                # 库头文件
│   └── src/                # 库源文件
├── Startup_config/         # 启动配置
│   ├── startup_stm32f40_41xxx.s  # 启动文件
│   ├── stm32f4xx.h         # 芯片定义
│   ├── stm32f4xx_conf.h    # 配置文件
│   └── system_stm32f4xx.c  # 系统配置
├── DSP_LIB/                # DSP库
│   ├── Include/            # DSP库头文件
│   └── arm_cortexM4lf_math.lib  # DSP库文件
├── Common/                 # 公共文件
│   ├── common.c            # 公共函数
│   └── common.h            # 公共头文件
└── Project/                # 项目文件
    ├── *.uvprojx          # Keil项目文件
    ├── *.hex              # 编译输出文件
    └── Objects/           # 编译对象文件
```

## 功能模块详解

### 1. 信号采集模块 (ADC)
- **ADC1**: 双通道采样，使用TIM2触发，DMA2传输
- **ADC3**: 双通道采样，支持实时电压显示
- **采样频率**: 可配置，支持高速连续采样

### 2. 信号处理模块 (FFT)
- **FFT点数**: 可配置 (默认1024点)
- **频谱显示**: 实时单边幅度频谱
- **峰值检测**: 自动检测主要频率分量

### 3. 波形分析模块
- **波形识别**: 支持正弦波、三角波、方波等
- **参数提取**: 频率、幅度、相位等参数
- **实时分析**: 基于FFT结果的实时波形分析

### 4. 信号生成模块 (AD9833)
- **波形类型**: 正弦波、三角波、方波
- **频率范围**: 0-12.5MHz
- **频率精度**: 1Hz
- **相位控制**: 0-360度可调

### 5. 人机交互模块
- **LCD显示**: 240x320彩色显示屏
- **触摸控制**: 电阻触摸屏支持
- **按键输入**: 5个硬件按键
- **LED指示**: 状态指示

### 6. 数据存储模块 (W25QXX)
- **容量**: 支持多种容量型号
- **接口**: SPI通信
- **功能**: 数据读写、扇区操作

## 使用说明

### 编译环境配置
1. 安装Keil MDK-ARM 5.x
2. 安装STM32F4固件库
3. 安装ARM CMSIS-DSP库
4. 打开项目文件 `Project/*.uvprojx`

### 硬件连接
- **电源**: 3.3V供电
- **调试**: ST-Link连接SWD接口
- **显示**: LCD通过FSMC接口连接
- **通信**: UART连接到USB转串口模块

### 按键功能
- **KEY1**: 启动DDS信号输出，频率为检测到的基频
- **KEY2**: 执行频率测量，DDS频率+1
- **KEY3**: LED3切换，DDS频率-1
- **KEY4**: 写入数据到Flash，更新DDS输出
- **KEY5**: 从Flash读取数据

### 操作流程
1. 系统上电后自动初始化所有外设
2. LCD显示ADC采样值和FFT频谱
3. 通过按键控制DDS信号输出
4. 实时显示波形分析结果
5. 支持数据存储和读取

## 技术参数

### 性能指标
- **ADC分辨率**: 12位
- **DAC分辨率**: 12位
- **FFT处理速度**: 实时处理
- **频率测量精度**: 0.001Hz
- **显示刷新率**: 30fps

### 通信接口
- **UART**: 115200bps
- **SPI**: 最高18MHz
- **I2C**: 标准模式100kHz
- **CAN**: 最高1Mbps

## 开发说明

### 代码规范
- 遵循STM32 HAL库编程规范
- 使用标准C语言语法
- 添加详细的中文注释
- 模块化设计，便于维护

### 扩展功能
- 支持添加新的波形类型
- 可扩展更多通信协议
- 支持自定义算法模块
- 便于集成新的传感器

## 许可证

本项目采用MIT许可证，详见 [LICENSE](LICENSE) 文件。

---

- **开发者**: dixi
- **项目**: 25EDC - 2025电子设计竞赛